import { Steps } from "nextra/components"
import { Table } from 'nextra/components'
import { Callout } from 'nextra/components'
import { CardInfo } from "@/app/_components/CardInfo.jsx"
import { Tabs } from 'nextra/components'

import {
  NumberOfContent,
  NumberWithMdx
} from "@/app/_components/NumberOfContent.jsx"


# Advanced Setup with Docker

> This guide covers **detailed configuration**, **customization**, **and operational topics** for running SpaceDF with Docker Compose.

<CardInfo title="Use this guide if you need:">
  -   Production-ready configuration
  -   Security hardening
  -   Custom ports, domains, or authentication
  -   Update, maintenance, and removal procedures
</CardInfo>
If you only want to get SpaceDF running quickly with default settings, see [Quick Start](/docs/getting-started/self-hosting/docker/quick-start).

---

## Contents
<br/>

<NumberOfContent number={1} title="Prerequisites" href="#prerequisites" description="What you need to prepare before setting up SpaceDF."/>
<NumberOfContent number={2} title="System Requirements" href="#system-requirements" description="Minimum hardware and software requirements."/>
<NumberOfContent number={3} title="Installing SpaceDF" href="#installing-spacedf" description="How to install SpaceDF using Docker."/>
<NumberOfContent number={4} title="Configuration and Security" href="#configuring-and-securing-spacedf" description="Basic configuration and recommended security settings."/>
<NumberOfContent number={5} title="Starting and Stopping SpaceDF" href="#starting-and-stopping" description="How to start, stop, and restart the services."/>
<NumberOfContent number={6} title="Accessing SpaceDF Services" href="#accessing-spacedf-services" description="How to access the dashboard and APIs after setup."/>
<NumberOfContent number={7} title="Updating SpaceDF" href="#updating" description="How to upgrade to a newer version safely."/>
<NumberOfContent number={8} title="Uninstalling SpaceDF" href="#uninstalling" description="How to remove SpaceDF from your system."/>

## Prerequisites
Before setting up SpaceDF, you should be familiar with some basic concepts. You do not need to be an expert, but you should understand:
- [Basic Linux](https://www.digitalocean.com/community/tutorials/linux-commands) server usage (connecting to a server, running commands).
- How Docker and Docker Compose work at a high level.
- Basic networking concepts such as [ports](https://www.cloudflare.com/learning/network-layer/what-is-a-computer-port) and [firewalls](https://www.cloudflare.com/learning/security/what-is-a-firewall/)

Make sure the following tools are installed on your machine or server:
- [Git](https://git-scm.com/downloads) ‚Äì used to download the SpaceDF source code
- [Docker](https://docs.docker.com/manuals/) ‚Äì used to run SpaceDF and its services

Install Docker based on your operating system:
- **Linux server or VPS**: Install [Docker Engine](https://docs.docker.com/engine/install/) and [Docker Compose](https://docs.docker.com/compose/install/)
- **Linux desktop**: Install [Docker Desktop](https://docs.docker.com/desktop/setup/install/linux/)
- **macOS**: Install [Docker Desktop](https://docs.docker.com/desktop/install/mac-install/)
- **Windows**: Install [Docker Desktop](https://docs.docker.com/desktop/install/windows-install/)

Once these requirements are met, you are ready to start installing SpaceDF.

## System requirements

Minimum requirements for running all SpaceDF Platform components, suitable for development and small to medium production workloads:

<div className="overflow-x-auto mt-4">
  <table className="w-full border-collapse text-left text-sm">
    <thead>
      <tr className="border-b border-gray-300 dark:border-gray-700">
        <th className="py-3 font-semibold text-gray-900 dark:text-gray-100">
          Resource
        </th>
        <th className="py-3 font-semibold text-gray-900 dark:text-gray-100">
          Minimum
        </th>
        <th className="py-3 font-semibold text-gray-900 dark:text-gray-100">
          Recommended
        </th>
      </tr>
    </thead>
    <tbody>
      <tr className="border-b border-gray-100 dark:border-gray-800">
        <td className="py-3 text-gray-700 dark:text-gray-300">RAM</td>
        <td className="py-3 text-gray-700 dark:text-gray-300">4 GB</td>
        <td className="py-3 text-gray-700 dark:text-gray-300">8 GB+</td>
      </tr>
      <tr className="border-b border-gray-100 dark:border-gray-800">
        <td className="py-3 text-gray-700 dark:text-gray-300">CPU</td>
        <td className="py-3 text-gray-700 dark:text-gray-300">2 cores</td>
        <td className="py-3 text-gray-700 dark:text-gray-300">4 cores+</td>
      </tr>
      <tr>
        <td className="py-3 text-gray-700 dark:text-gray-300">Disk</td>
        <td className="py-3 text-gray-700 dark:text-gray-300">
          20 GB available
        </td>
        <td className="py-3 text-gray-700 dark:text-gray-300">
          80 GB+ SSD
        </td>
      </tr>
    </tbody>
  </table>
</div>

## Installing SpaceDF
Follow the steps below to install and run SpaceDF on your machine.

```bash copy

# Make your new spacedf project directory
mkdir spacedf-project

# Get the code
cd spacedf-project
git clone https://github.com/Space-DF/spacedf-core.git

# Switch to your project directory
cd spacedf-core

# Copy the env vars
cp .env.example .env

# Pull the latest images
docker compose pull
```

## Configuration & Security

Before starting SpaceDF, you need to set up the environment variables.

<Tabs items={['Manual', 'Terminal']}>
    <Tabs.Tab>
      <NumberWithMdx number={1} className="mt-6 ml-6">
          Copy the `.env.example` file in the root directory.
      </NumberWithMdx>
      <NumberWithMdx number={2} className="ml-6">
          Rename the copy to `.env`
      </NumberWithMdx>
      <NumberWithMdx number={3} className="ml-6">
          Update the values in `.env` following the guide below.
      </NumberWithMdx>
    </Tabs.Tab>

    <Tabs.Tab>
    Run the following command in your project root directory:

    ```bash copy
    # Switch to your project directory
    cd spacedf-core
    
    # Copy the env vars
    cp .env.example .env
    ```
    </Tabs.Tab>
</Tabs>

<Callout type="warning">
    Review the configuration options below and make sure all secret values are set before starting SpaceDF.
</Callout>

<Callout type="important">
***Security notes***
- **Do not commit** passwords, secrets, or API keys to Git
- **Do not expose secret values** on the client side (browser)
- If a value is marked as **‚ÄúKeep this value secret‚Äù**, it must never be shared publicly
- **Do not reuse secrets** across systems or environments
- Use strong and unique passwords for all services
- Use the **minimum required permissions** for all credentials
- **Rotate keys immediately** if they are **exposed**
- Use **HTTPS / WSS** in production environments
</Callout>

### Configuring Environment Variables
This section explains how to configure the required environment variables in the `.env` file before starting SpaceDF.

Open the `.env` file using a text editor (for example: VS Code, Nano, or Notepad).

#### Services Configuration

These environment variables configure the backend services that power the self-hosted SpaceDF server.  
Backend services include APIs, messaging, databases, and integrations required to run the core system.

##### RabbitMQ credentials
> RabbitMQ is used by SpaceDF for **background tasks** and **internal message** processing between services.

You can **choose any username and password you want**, as long as:
- The same values are used by **RabbitMQ** and **all SpaceDF services**
- The credentials are defined in the environment variables below

```bash copy
# Replace with your own values.
RABBITMQ_DEFAULT_USER=your_username
RABBITMQ_DEFAULT_PASS=your_password
```

`RABBITMQ_DEFAULT_USER` - The username SpaceDF uses to connect to RabbitMQ.<br/>
`RABBITMQ_DEFAULT_PASS` - The password for the RabbitMQ user above.

<Callout type="warning">
  Do not use simple or common passwords. This account controls access to your message queue. <br/>
  Keep these credentials safe‚Äîyou may need them to log in to RabbitMQ for troubleshooting later.
</Callout>

---
##### Authentication (JWT)
> SpaceDF uses JSON Web Tokens (JWT) to authenticate users and secure API requests.

You must set a **private key** and a **public key** before starting SpaceDF.

<NumberWithMdx number={1} href="" className="mt-6">
    **Recommended:** Generate a new key pair
</NumberWithMdx>
```bash copy
openssl genrsa -out private_key.pem 2048
openssl rsa -in private_key.pem -pubout -out public_key.pem
```
<NumberWithMdx number={2} href="" className="mt-6">
   Copy the key contents from your local machine<br/>
   Choose the command based on your operating system:
  <Tabs items={['macOS', 'Windows', 'Linux']}>
    <Tabs.Tab>
    ```bash copy
    pbcopy < private_key.pem
    pbcopy < public_key.pem
    ```
    </Tabs.Tab>

    <Tabs.Tab>
    ```powershell copy
    Get-Content private_key.pem | Set-Clipboard
    Get-Content public_key.pem | Set-Clipboard
    ```
    </Tabs.Tab>

    <Tabs.Tab>
    ```bash copy
    cat private_key.pem | xclip -selection clipboard
    cat public_key.pem | xclip -selection clipboard
    ```
    </Tabs.Tab>
  </Tabs>
</NumberWithMdx>
<NumberWithMdx number={3} href="" className="mt-6">
    Paste the keys into your `.env` file:
</NumberWithMdx>
```bash copy
JWT_PRIVATE_KEY=-----BEGIN RSA PRIVATE KEY-----...
JWT_PUBLIC_KEY=-----BEGIN PUBLIC KEY-----...
```

`JWT_PRIVATE_KEY` - Signs authentication tokens (***Keep this key secret.***). <br/>
`JWT_PUBLIC_KEY` - Verifies authentication tokens. This key can be shared with other services if needed.
> Make sure the keys are pasted correctly and not broken across lines.
---
##### Google OAuth
> Google OAuth allows users to sign in to SpaceDF using their Google account.

To enable Google login, you need to create OAuth credentials in the ***Google Cloud Console*** and set the values below in your `.env` file.

**How to get Google OAuth credentials**
<NumberWithMdx number={1} className="mt-3">
    Go to the [Google Cloud Console](https://console.cloud.google.com/)
</NumberWithMdx>
<NumberWithMdx number={2}>
    Create or select a project.
</NumberWithMdx>
<NumberWithMdx number={3}>
    Enable **Google Identity Services**.
</NumberWithMdx>
<NumberWithMdx number={4}>
    Go to **APIs & Services ‚Üí Credentials**.
</NumberWithMdx>
<NumberWithMdx number={5}>
    Create an **OAuth 2.0 Client ID:**<br/>
    Application type: **Web application**<br/>
    <img src="/screenshots/google-oauth.png" className="w-full mt-2"/>
    *If you see a warning about **OAuth consent screen** or **branding** not being configured, you must complete the **OAuth consent screen setup** first before creating the Client ID.*
</NumberWithMdx>
<NumberWithMdx number={6}>
    Authorized redirect URI: (`GOOGLE_CALLBACK_URL`)<br/>
    This is the callback URL that Google redirects to after a user successfully signs in with Google.
    ```bash copy
     # Production
     https://your-domain.com/auth/google/callback

     # Development
     http://localhost:3000/auth/google/callback
    ```
</NumberWithMdx>
<NumberWithMdx number={7} className="mb-3">
   Copy the generated **Client ID** and **Client Secret** into your `.env` file.
</NumberWithMdx>

```bash copy
# Replace with your own values.
GOOGLE_CALLBACK_URL=your_google_callback_uri
GOOGLE_CLIENT_ID=your_google_client_id #(Step 5)
GOOGLE_CLIENT_SECRET=your_google_client_secret #(Step 5)
```
`GOOGLE_CALLBACK_URL` - The URL Google redirects users back to after successful login.<br/>
`GOOGLE_CLIENT_ID` - Identifies your application to Google.<br/>
`GOOGLE_CLIENT_SECRET` - A private key used by SpaceDF to securely communicate with Google (***Keep this value secret.***)

<Callout type="info">
Use HTTPS for the callback URL in production.
</Callout>
---
##### Apple OAuth (Coming Soon)

Apple sign-in support is planned but not yet supported in SpaceDF.

<Callout type="warning">
  Do not configure these values yet.
  Apple OAuth is **not supported** in the current release.
</Callout>

```bash copy
# Apple OAuth (reserved for future use)
APPLE_CLIENT_ID=your_apple_client_id
APPLE_CLIENT_SECRET=your_apple_client_secrect
APPLE_CLIENT_KEY=your_apple_client_key
APPLE_CERTIFICATE_KEY=your_apple_certificate_key
```
---
##### Auth Service
> The Auth Service is responsible for user authentication, authorization, and tenant management in SpaceDF.

**`AUTH_POSTGRES_PASSWORD`**

The password used by the Auth Service to connect to its *PostgreSQL database*. (*Use a strong and unique password.*)

```bash copy
AUTH_POSTGRES_PASSWORD=your_auth_postgres_password
```

**`AUTH_SECRET_KEY`**

A secret key used to sign and validate authentication-related data. (*Keep this value private.*)

Generate secure random values for secret keys:
```bash copy
openssl rand -hex 32
```

Paste the generated Secret Key into your `.env` file:
```bash copy
AUTH_SECRET_KEY=your_auth_secret_key
```

**`DEFAULT_TENANT_HOST`**

The default domain or host assigned to the initial tenant. This is usually your main application domain.

<Tabs items={['Development', 'Production']}>
    <Tabs.Tab>
    ```bash copy
    DEFAULT_TENANT_HOST=localhost
    ```
    </Tabs.Tab>

    <Tabs.Tab>
    ```bash copy
    DEFAULT_TENANT_HOST=your_api_domain
    ```
    </Tabs.Tab>
</Tabs>

---
##### S3 Service
> The Amazon S3 service is used by SpaceDF to store files such as uploads, assets, and generated data.

<Callout type="info">
    SpaceDF supports **Amazon S3 only** for file storage in this setup.
</Callout>

SpaceDF connects to Amazon S3 using **IAM credentials** that you provide in the `.env` file. All file operations (upload, read, delete) are handled internally by SpaceDF services.<br/>
End users do **not** need AWS accounts or credentials.

If you do not already have an AWS account, create one at, [see more](https://repost.aws/knowledge-center/create-and-activate-aws-account): <br/>
https://signin.aws.amazon.com/signup?request_type=register

After creating your account, sign in to the AWS Management Console to continue with the steps below. 

**Create an S3 bucket**

<NumberWithMdx number={1} className="mt-6">
    Open the [Amazon S3 Console](https://console.aws.amazon.com/s3/)
</NumberWithMdx>
<NumberWithMdx number={2}>
    Create a new bucket
</NumberWithMdx>
<NumberWithMdx number={3}>
    Choose:<br/>
        A unique bucket name -> will be used for `AWS_STORAGE_BUCKET_NAME`<br/>
        An AWS region close to your server ‚Üí will be used for `AWS_REGION`
    <img src="/screenshots/bucket-guide.png" className="w-full mt-2"/>
</NumberWithMdx>

Save the bucket name and region for later use.

Read more: [AWS documentation](https://docs.aws.amazon.com/AmazonS3/latest/userguide/GetStartedWithS3.html#creating-bucket)

**Create IAM credentials**
<NumberWithMdx number={1} className="mt-6">
    Open the [AWS IAM Console](https://console.aws.amazon.com/iam/)
</NumberWithMdx>
<NumberWithMdx number={2}>
    Create a new **IAM user**
</NumberWithMdx>
<NumberWithMdx number={3}>
    Grant the user access to the S3 bucket<br/>
    *Recommended:* grant only required S3 permissions (read/write)
</NumberWithMdx>
<NumberWithMdx number={4}>
    Create an **Access Key** for the user<br/>
    Access Key ID, Secret Access Key
    <img src="/screenshots/iam-credentials.png" className="w-full mt-2"/>
</NumberWithMdx>

Read more: [AWS documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html)

<Callout type="info">
Use IAM policies with **minimum required permissions**.
</Callout>

**Set values in `.env`**
```bash copy
# Replace with your own values.
AWS_ACCESS_KEY_ID=your_access_key_id #IAM credentials (Step 4)
AWS_SECRET_ACCESS_KEY=your_secret_access_key #IAM credentials (Step 4)
    
AWS_STORAGE_BUCKET_NAME=your_aws_storage_bucket_name #S3 bucket (Step 3)
AWS_REGION=your_aws_region #S3 bucket (Step 3)
```

- `AWS_ACCESS_KEY_ID` - The access key used by SpaceDF to authenticate with S3.
- `AWS_SECRET_ACCESS_KEY` - The secret key paired with the access key above. (*Keep this value private*)
- `AWS_STORAGE_BUCKET_NAME` - The name of the S3 bucket where SpaceDF stores files.
- `AWS_REGION` - The AWS region where the S3 bucket is located. (e.g., `us-east-1`, `ap-southeast-1`).
---
##### Redis
> Redis is used by SpaceDF for caching and fast data access.

Set the Redis connection URL in the `.env` file.

```bash copy
# Replace with your own values.
REDIS_HOST="redis://redis:6379/1"
```
- `redis://` ‚Äî Connection protocol
- `redis` ‚Äî Redis service name (default in Docker)
- `6379` ‚Äî Default Redis port
- `/1` ‚Äî Redis database number

<CardInfo title="When you do NOT need to change this:" classNames={{
  container: "!mt-6 !p-3 shadow-none",
  title: "!text-lg",
  description: "!text-sm"
}}>
  -   You are using the provided Docker setup
  -   Redis is running as part of the included Docker Compose file
</CardInfo>

<CardInfo title="When you SHOULD change this:" classNames={{
  container: "!mt-6 !p-3 shadow-none",
  title: "!text-lg",
  description: "!text-sm"
}}>
  -   Redis runs on a different server or host
  -   Redis uses a non-default port
  -   You want to use a different Redis database
</CardInfo>

---
##### Dashboard Service
> The Dashboard Service provides the web interface for managing SpaceDF, including administration and monitoring features.

**`DASHBOARD_POSTGRES_PASSWORD`**

The password used by the Dashboard Service to connect to its PostgreSQL database. (*Use a strong and unique password*.)

```bash copy
DASHBOARD_POSTGRES_PASSWORD=your_postgres_password
```

**`DASHBOARD_SECRET_KEY`**

A secret key used to sign and validate authentication-related data. (*Keep this value private.*)

Generate secure random values for secret keys:
```bash
openssl rand -hex 32
```

Paste the generated Secret Key into your `.env` file:
```bash copy
DASHBOARD_SECRET_KEY=your_secret_key
```

---
##### Device Service
> The Device Service manages devices, device data, and communication with telemetry-related services in SpaceDF.

**`DEVICE_POSTGRES_PASSWORD`**

The password used by the Device Service to connect to its PostgreSQL database. (*Use a strong and unique password*.)

```bash copy
DEVICE_POSTGRES_PASSWORD=your_postgres_password
```

**`DEVICE_SECRET_KEY`**

A secret key used to sign and validate authentication-related data. (*Keep this value private.*)

Generate secure random values for secret keys:
```bash
openssl rand -hex 32
```

Paste the generated Secret Key into your `.env` file:
```bash copy
DEVICE_SECRET_KEY=your_secret_key
```
---

##### Telemetry service

Defines the internal Docker service address that SpaceDF uses to communicate with the Telemetry Service.

When using the **default Docker setup**, the Telemetry Service runs as a Docker container and is accessible via its **service name**.

```bash copy
# Default (recommended)
TELEMETRY_SERVICE_URL=http://telemetry:8080
```
<CardInfo classNames={{
  container: "!mt-6 !p-3 shadow-none",
  description: "!text-base"
}}>
  - This value is the same for both **local and production** deployments when using Docker Compose.
  - The Telemetry Service runs from a **Docker image** and is exposed internally.
  - You **do not need to change this value** in most cases.
</CardInfo>

Only change this value if you modify the Telemetry Service name or port in `docker-compose.yml`.

---
##### EMQX Service
> EMQX is the MQTT broker used by SpaceDF to handle device messaging and real-time communication.

Choose a username and a strong password:

```bash copy
# Replace with your own values.
EMQX_HOST=http://emqx:18083/api/v5
EMQX_USERNAME=your_emqx_username
EMQX_PASSWORD=your_emqx_password
```
`EMQX_HOST` - The base URL of the EMQX Management API used by SpaceDF. This is typically the EMQX service running inside Docker.<br/>
`EMQX_USERNAME` - The username SpaceDF uses to authenticate with the EMQX broker.<br/>
`EMQX_PASSWORD` - The password for the EMQX user above. (*Use a strong and unique password*.)

---
##### Broker Bridge Service
> The Broker Bridge Service connects SpaceDF to an external MQTT broker or bridges messages between brokers.

**Broker credentials**
```bash copy
# Replace with your own values.
MQTT_BROKER_BRIDGE_USERNAME=your_username
MQTT_BROKER_BRIDGE_PASSWORD=your_password
```

`MQTT_BROKER_BRIDGE_USERNAME` - The username used to authenticate with the external MQTT broker. <br/>
`MQTT_BROKER_BRIDGE_PASSWORD` - The password for the broker bridge user. (*Keep this value private*.)

**MQTT topics**

Specify one or more topics, separated by commas.
```bash copy
MQTT_TOPICS=device/+/telemetry,device/+/status
```
`MQTT_TOPICS` - A list of MQTT topics that SpaceDF subscribes to or bridges.

---
##### AWS to access to SES service
> SpaceDF uses email services to send system emails such as account verification, password resets, and notifications.

This setup commonly uses **AWS Simple Email Service (SES)**, but can be adapted to other SMTP-compatible providers.

**How to get AWS SES credentials**
<NumberWithMdx number={1} className="mt-3">
    Sign in to the [AWS Console](https://aws.amazon.com/console/)
</NumberWithMdx>
<NumberWithMdx number={2}>
  Open **Simple Email Service (SES)**.
</NumberWithMdx>
<NumberWithMdx number={3}>
   Verify your domain or sender email address.
</NumberWithMdx>
<NumberWithMdx number={4}>
    Create **SMTP credentials** in SES:
    <ul>
        <li>
           These are different from your AWS access keys.
        </li>
    </ul>
</NumberWithMdx>
<NumberWithMdx number={5}>
    Copy the SMTP username and password into:
     <ul>
        <li>
           `EMAIL_HOST_USER`
        </li>
        <li>
           `EMAIL_HOST_PASSWORD`
        </li>
    </ul>
</NumberWithMdx>

Set the following values in your `.env` file.
```bash copy
# Replace with your own values.
EMAIL_HOST_USER=AKIAXXXXXXXX
EMAIL_HOST_PASSWORD=XXXXXXXXXXXXXXXX
DEFAULT_FROM_EMAIL=no-reply@spacedf.example
```
- `EMAIL_HOST_USER` - The SMTP username generated by AWS SES.
- `EMAIL_HOST_PASSWORD` - The SMTP password generated by AWS SES (***Keep this value secret***)
- `DEFAULT_FROM_EMAIL` - The sender email address shown to users.
---
##### MPA Service
> The MPA Service connects SpaceDF to an MQTT broker to receive and publish messages for application-level processing.

Example: MQTT broker running in Docker
```bash copy
# Replace with your own values.
MQTT_BROKER=emqxl
MQTT_PORT=1883
MQTT_USERNAME=mpa
MQTT_PASSWORD=change_this_to_a_secure_password
MQTT_CLIENT_ID=spacedf-mpa
MQTT_TOPIC=devices/+/events
```
- `MQTT_BROKER` - The hostname or IP address of the MQTT broker.
- `MQTT_USERNAME` - The username used to authenticate with the MQTT broker.
- `MQTT_PASSWORD` - The password for the MQTT user. (***Keep this value private***.)
- `MQTT_PORT` - The port used to connect to the MQTT broker (e.g., `1883` for plain TCP, `8883` for TLS).
- `MQTT_CLIENT_ID` - A unique client identifier for the MPA Service when connecting to MQTT.
- `MQTT_TOPIC` - The MQTT topic the MPA Service subscribes to.

<Callout type="info">
  Use TLS (`8883`) in production if available<br/>
  Restrict broker permissions to required topics only
</Callout>
---
##### Bootstrap Service
> The Bootstrap Service is the **backend service** responsible for initial system setup and cross-service coordination when SpaceDF starts.

This service runs inside Docker as the SpaceDF backend.

**Service host**

This value defines the **base URL** where the Bootstrap (Backend) service is accessible.
```bash copy 
# Local development (default)
HOST=http://localhost:8000
```
For production deployments, set this to your **public API domain**:
```bash copy 
# Replace with your public API domain.
HOST=https://api.spacedf.example
```

`HOST` - The public base URL where the Bootstrap Service is accessible. This is used by other services to communicate with it.

<CardInfo title="If you change the backend port, make sure to update:" classNames={{
  container: "!mt-6 !p-3 shadow-none",
  title: "!text-base",
  description: "!text-sm"
}}>
  - HOST in your `.env` file
  - The backend port in `docker-compose.yml`
</CardInfo>

**CORS origins**

List all frontend origins that should be allowed to access the service.
Separate multiple values with commas.

Development (local)
```bash copy 
# Local development (default)
CORS_ALLOWED_ORIGINS=http://localhost,http://localhost:3000,http://localhost:3001
```

Production
```bash copy 
# Replace with your own values.
CORS_ALLOWED_ORIGINS=https://app.spacedf.example,https://admin.spacedf.example
```

`CORS_ALLOWED_ORIGINS` - A comma-separated list of allowed origins for cross-origin requests. This controls which frontend domains can access the Bootstrap Service.

<Callout type="info">
  **Important notes**
  - Controls **which frontend domains can access** the Bootstrap service
  - Each frontend **must be listed explicitly**, including protocol and port
  - If you change frontend ports in `docker-compose.yml`, update both the Docker ports and `CORS_ALLOWED_ORIGINS`
</Callout>

Example:

If the Dashboard is moved from port `3000` to `4000`, you must add:

```text copy
http://localhost:4000
```
to `CORS_ALLOWED_ORIGINS`.

**Secret key**: Generate a secure random value:
```bash
openssl rand -hex 32
```

Set it in your `.env` file:

```bash copy
# Replace with your own values.
BOOTSTRAP_SECRET_KEY=generated_secret_value
```
`BOOTSTRAP_SECRET_KEY` - A secret key used to secure internal Bootstrap operations. (***Keep this value private.***)

---
##### Organization Initialization
> These settings are used to create the **initial organization and owner account** when SpaceDF starts for the first time. This step runs only during the first startup.

```bash copy
# Replace with your own values.
ORG_NAME=SpaceDF
ORG_SLUG=spacedf
OWNER_EMAIL=admin@spacedf.example
OWNER_PASSWORD=change_this_to_a_secure_password
```

- `ORG_NAME` - The display name of your organization.
- `ORG_SLUG` - A short, URL-friendly identifier for the organization (lowercase, no spaces).
- `OWNER_EMAIL` - The email address of the initial organization owner.
- `OWNER_PASSWORD` - The password for the owner account. (***Use a strong and secure password***.)

---
üéâ You have now finished configuring the backend services. <br/>
Next, continue with the frontend (web app) configuration.

---
### Admin Portal Configuration
<CardInfo classNames={{
  container: "!mt-6 !p-3 shadow-none",
  description: "!text-base"
}}>
  The Admin Portal is used for **system-level** and **organization-level** administration.<br/>
  This application is typically accessed by **platform administrators**, not end users.
</CardInfo>

Configure these environment variables to connect the Admin Portal to backend services and authentication providers.

<Callout type="warning">
  **Before continuing** <br/>
    Make sure you have completed the **Backend Services Configuration** above.<br/>
    The Admin Portal depends on backend authentication and API services.
</Callout>
##### Authentication

**Generate NextAuth secret**

Open the [following link](https://generate-secret.vercel.app/32) in your browser to generate a secure random secret:

Copy the generated value and set it in your `.env` file:

```bash copy
# Replace with your own values.
PORTAL_NEXTAUTH_SECRET=4f7c2a9e8d1b6c3f0a...
```
`PORTAL_NEXTAUTH_SECRET` - A secret key used by NextAuth to encrypt sessions and tokens. (***Keep this value private.***)

**Admin Portal URL**

Development
```bash copy
HOST_FRONTEND_ADMIN=http://localhost:3001
PORTAL_NEXTAUTH_URL=http://localhost:3001
```

Production
```bash copy
HOST_FRONTEND_ADMIN=https://admin.spacedf.example
PORTAL_NEXTAUTH_URL=https://admin.spacedf.example
```

- `HOST_FRONTEND_ADMIN` - The public URL where the Admin Portal is accessible.
- `PORTAL_NEXTAUTH_URL` - The base URL used by NextAuth for redirects and callbacks. <br/>This value should match the Admin Portal public URL.
---
##### API Access

**Using Docker**
```bash copy
PORTAL_AUTH_API=http://haproxy:3000
```

**External API**
```bash copy
# Replace with your own values.
PORTAL_AUTH_API=https://api.spacedf.example
```

`PORTAL_AUTH_API` - The backend API endpoint used by the Admin Portal for authentication.<br/>
This typically points to the internal API gateway or load balancer.

---
##### References

Use the official documentation below if you need more details about **NextAuth** behavior or advanced configuration:
- [NextAuth.js Documentation](https://next-auth.js.org/)
- [NextAuth Environment Variables](https://next-auth.js.org/configuration/options)
- [NextAuth Security Guide](https://next-auth.js.org/security)
---
### Dashboard Configuration
This section configures the **SpaceDF Dashboard**, the main web interface used for daily operations, device monitoring, and data visualization.

<Callout type="warning">
  **Before continuing** <br/>
    Make sure you have completed the **Backend Services Configuration** above. <br/>
    The Dashboard depends on backend APIs, MQTT, and authentication services.
</Callout>

##### Authentication

**Generate NextAuth secret**

Open the [following link](https://generate-secret.vercel.app/32) in your browser to generate a secure random secret:

Copy the generated value and set it in your `.env` file:

```bash copy
# Replace with random secret.
DASHBOARD_NEXTAUTH_SECRET=4f7c2a9e8d1b6c3f0a...

# The public URL where the Dashboard is accessible.
DASHBOARD_NEXTAUTH_URL=http://localhost:3000
```
- `DASHBOARD_NEXTAUTH_SECRET` - A secret key used by NextAuth to encrypt sessions and tokens. (***Keep this value private.***)
- `DASHBOARD_NEXTAUTH_URL` - The public URL where the Dashboard is accessible.<br/>
This value is used for redirects and callbacks.
---
##### API Access

**Using Docker**
```bash copy
DASHBOARD_AUTH_API=http://haproxy:3000
```

**External API**
```bash copy
# Replace with your own values.
DASHBOARD_AUTH_API=https://api.spacedf.example
```
---
##### Map Services
> The Dashboard uses **MapTiler** as a map service to resolve location names from coordinates and support location-based features.

**How to get a MapTiler API key**
<NumberWithMdx number={1} className="mt-3">
    Create a MapTiler account: [MapTiler](https://www.maptiler.com/)
</NumberWithMdx>
<NumberWithMdx number={2}>
   Go to your dashboard and create an **API key**.
</NumberWithMdx>
<NumberWithMdx number={3}>
   Copy the key and set it as `MAPTILER_API_KEY`.
</NumberWithMdx>

```bash copy
# Replace with your API Key.
MAPTILER_API_KEY=__MAPTILER_API_KEY__
```
---
##### MQTT (Real-time Data)
> The Dashboard connects to MQTT to receive real-time device data.

**Recommended values**<br/>
**Development**
```bash copy
DASHBOARD_MQTT_PROTOCOL=ws
DASHBOARD_MQTT_PORT=8883
DASHBOARD_MQTT_BROKER=emqx.localhost:8000
```

**Production**
```bash copy
# Use wss (secure WebSocket) in production.
DASHBOARD_MQTT_PROTOCOL=wss
DASHBOARD_MQTT_PORT=443
DASHBOARD_MQTT_BROKER=emqx.example.com
```

- `DASHBOARD_MQTT_USERNAME` / `DASHBOARD_MQTT_PASSWORD` - Credentials used by the Dashboard to connect to the MQTT broker.
- `DASHBOARD_MQTT_PROTOCOL` - Protocol used for MQTT connections. <br/>
Use ws (WebSocket) for browser-based clients.
- `DASHBOARD_MQTT_PORT` - Port exposed by the MQTT broker for WebSocket connections.
- `DASHBOARD_MQTT_BROKER` - Host and port of the MQTT broker accessible from the browser.

<Callout type="info">
  Use HTTPS and `wss` in production environments <br/>
  Restrict MQTT permissions to read-only topics for the Dashboard
</Callout>
---
##### References
- [NextAuth.js Documentation](https://next-auth.js.org/)
- [MapTiler Documentation](https://docs.maptiler.com/)
- [MQTT over WebSocket](https://www.emqx.com/en/blog/connect-to-mqtt-broker-with-websocket)

## Starting and Stopping
> This section explains how to start, check, and stop SpaceDF services using Docker Compose.

### Starting the services
From the directory that contains your `./entrypoint.sh` file, run:

```bash copy 
# Start all services in the background
chmod +x entrypoint.sh
./entrypoint.sh
```

Docker will start all SpaceDF services in detached mode.

### Checking service status
After starting, you can check the status of all services:
```bash copy 
docker compose ps
```
Within a minute, most services should show a status similar to:
```scss copy 
Up (healthy)
```

### Troubleshooting startup issues
If a service shows a status like `created` or does not become Up, check its logs to see what went wrong.

For example, to view logs for a specific service:
```bash copy 
docker compose logs analytics
```
Review the logs for errors such as missing environment variables or connection issues.

### Stopping the services
To stop all running SpaceDF services, run:
```bash copy 
docker compose down
```
This stops and removes the containers but keeps your data volumes intact.

<Callout type="info">
  **Notes**
  - Starting and stopping services may take a short time
  - Always check service status after starting
  - Stop services before making configuration changes
</Callout>

## Accessing SpaceDF Services
> After all services are running, you can access SpaceDF through the web interfaces and backend APIs using the URLs below.

<div className="overflow-x-auto mt-4">
  <table className="w-full border-collapse text-left text-sm">
    <thead>
      <tr className="border-b border-gray-300 dark:border-gray-700">
        <th className="py-3 font-semibold text-gray-900 dark:text-gray-100">
          Service
        </th>
        <th className="py-3 font-semibold text-gray-900 dark:text-gray-100">
          Port
        </th>
      </tr>
    </thead>
    <tbody>
        <tr className="border-b border-gray-100 dark:border-gray-800">
            <td className="py-3 text-gray-700 dark:text-gray-300">Dashboard</td>
            <td className="py-3 text-gray-700 dark:text-gray-300">localhost:3000</td>
        </tr>
        <tr className="border-b border-gray-100 dark:border-gray-800">
            <td className="py-3 text-gray-700 dark:text-gray-300">Admin Portal</td>
            <td className="py-3 text-gray-700 dark:text-gray-300">localhost:3001</td>
        </tr>
        <tr className="border-b border-gray-100 dark:border-gray-800">
            <td className="py-3 text-gray-700 dark:text-gray-300">Backend API</td>
            <td className="py-3 text-gray-700 dark:text-gray-300">localhost:8000</td>
        </tr>
        <tr className="border-b border-gray-100 dark:border-gray-800">
            <td className="py-3 text-gray-700 dark:text-gray-300">EMQX (API)</td>
            <td className="py-3 text-gray-700 dark:text-gray-300">localhost:18083</td>
        </tr>
        <tr className="border-b border-gray-100 dark:border-gray-800">
            <td className="py-3 text-gray-700 dark:text-gray-300">MQTT (WebSocket)</td>
            <td className="py-3 text-gray-700 dark:text-gray-300">localhost:8883</td>
        </tr>
    </tbody>
  </table>
</div>

<Callout type="info">
  **Notes**
  - Make sure all services show **Up (healthy)** before accessing them
  - Use HTTPS in production environments
  - Ensure firewall and reverse proxy settings allow access to the required ports
</Callout>

## Updating
SpaceDF publishes stable updates for the Docker Compose setup on a regular basis.
To update your self-hosted deployment, pull the latest changes from the repository and restart the services.

> Updating services requires restarting containers and may cause temporary downtime.

### General update process
<NumberWithMdx number={1} className="mt-6">
   Pull the latest changes from the SpaceDF repository.
</NumberWithMdx>
<NumberWithMdx number={2}>
    Pull updated Docker images.
</NumberWithMdx>
<NumberWithMdx number={3}>
   Restart the services.
</NumberWithMdx>

In most cases, this is enough to apply the latest updates.

### Updating individual services (advanced)
You can run a specific version of a service by changing its Docker image tag in the `docker-compose.yml` file.

<Callout type="warning">
  Running mixed versions of services is **not guaranteed to be compatible**. <br/>
  This approach is recommended only if you know exactly what you are doing.
</Callout>

#### Update or rollback a single service

For example, if you want to update or roll back the Dashboard service:
<NumberWithMdx number={1} className="mt-6">
   Check available images and tags on the [SpaceDF container registry](https://github.com/orgs/Space-DF/packages).
</NumberWithMdx>
<NumberWithMdx number={2}>
    Choose a version tag (for example: `v2026.01.21`).
</NumberWithMdx>
<NumberWithMdx number={3}>
   Update the image field in `docker-compose.yml`
   ```yml copy
    image: ghcr.io/space-df/spacedf-web-app:v2026.01.21
    ```
</NumberWithMdx>
<NumberWithMdx number={4}>
   Apply the changes:
   ```bash copy
    docker compose pull
    docker compose down
    docker compose up -d
    ```
</NumberWithMdx>

The service will restart using the specified version.

### Notes on downtime
- Services must be restarted to apply updates
- Active users may experience brief downtime
- Consider performing updates during low-traffic periods

### Staying up to date
- To track changes, fixes, and new features, refer to:
    - SpaceDF release notes
- The self-hosting changelog in the repository

## Uninstalling

<Callout type="warning">
  **Warning**<br/>
  The steps below will permanently delete all SpaceDF data, including databases and storage volumes.<br/>
  Make sure you have backups before continuing.
</Callout>

### Stop and remove services
From the directory that contains your `docker-compose.yml` file, run:
```bash copy 
# Stop all services and remove containers and volumes
docker compose down -v
```

This command stops all SpaceDF services and removes all associated Docker volumes.

### (Optional) Remove remaining data manually
In some cases, you may want to ensure all data directories are fully removed.

**Remove database data**
```bash copy 
rm -rf volumes/db/data
```

**Remove storage data**
```bash copy 
rm -rf volumes/storage
```

**What gets removed**
- All SpaceDF services
- All databases and stored data
- All uploaded files and assets

After these steps, SpaceDF is completely removed from your system.

<Callout type="info">
  **Notes**
  - These actions **cannot be undone**
  - Use this only if you want a clean uninstall
  - For reinstallation, follow the setup guide from the beginning
</Callout>

## Demo

## Need Help?

- **[Community Forum](https://docs.spacedf.com/community)** - Get help from the SpaceDF community
- **[Discord Server](https://discord.gg/HxCTyMCzuK)** - Real-time chat with other users and developers
- **[Documentation](/devices)** - Comprehensive guides and tutorials
- **[Professional Support](/support)** - Enterprise support with SLA guarantees

---

**Ready to start?** [Create your SpaceDF account](https://spacedf.com/en/auth/sign-up) and begin tracking your devices in minutes!